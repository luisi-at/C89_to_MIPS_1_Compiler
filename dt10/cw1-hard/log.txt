al3515 : Checking we're on branch cw1-hard
cd ${REPOS}/$U && git rev-parse --abbrev-ref HEAD

log_msg "########################################################"
al3515 : ########################################################
log_msg "## Building"
al3515 : ## Building

log_msg "Cleaning"
al3515 : Cleaning
(cd $REPO && rm bin/c_lexer)
(cd $REPO && make clean)
rm c_lexer c_lexer.exe
rm: cannot remove 'c_lexer': No such file or directory
rm: cannot remove 'c_lexer.exe': No such file or directory
makefile:10: recipe for target 'clean' failed
make: [clean] Error 1 (ignored)
rm *.yy.cpp
rm: cannot remove '*.yy.cpp': No such file or directory
makefile:10: recipe for target 'clean' failed
make: [clean] Error 1 (ignored)

log_msg "Building"
al3515 : Building
(cd $REPO && make bin/c_lexer)
g++ -W -Wall -g -std=gnu++11 -o bin/c_lexer  src/c_lexer.yy.cpp src/lexer_main.cpp
c_lexer.yy.cpp: In function ‘int yy_get_next_buffer()’:
c_lexer.yy.cpp:1706:44: warning: comparison between signed and unsigned integer expressions [-Wsign-compare]
c_lexer.yy.cpp: At global scope:
c_lexer.yy.cpp:1782:17: warning: ‘void yyunput(int, char*)’ defined but not used [-Wunused-function]

if [[ ! -f $REPO/bin/c_lexer ]]; then
    log_msg "No executable build"
    exit 0;
fi

log_msg "########################################################"
al3515 : ########################################################
log_msg "## Executing lexer for inputs"
al3515 : ## Executing lexer for inputs

log_msg "Cleaning + Copying inputs"
al3515 : Cleaning + Copying inputs
(mkdir -p $LOGDIR/working)


log_msg "Running reference lexer"
al3515 : Running reference lexer
for i in scripts/cw1/inputs/*.c ; do
    log_msg "####################"
    NAME=$(basename $i .c)
    log_msg "  Test ${i}"

    cp $i $LOGDIR/working/$NAME.c
    cat $LOGDIR/working/$NAME.c  |  scripts/cw1/ref_tokeniser/bin/c_lexer > $LOGDIR/working/$NAME.ref.json

    cat $LOGDIR/working/$NAME.c | (cd $REPO && bin/c_lexer ) >$LOGDIR/working/$NAME.got.json 2>$LOGDIR/working/$NAME.got.stderr

    python3 scripts/cw1/compare_json.py $U $NAME $LOGDIR/working/$NAME.ref.json $LOGDIR/working/$NAME.got.json >$LOGDIR/working/$NAME.compare.csv 2>$LOGDIR/working/$NAME.compare.stderr
done
al3515 : ####################
basename $i .c
al3515 :   Test scripts/cw1/inputs/char-1.c
al3515 : ####################
basename $i .c
al3515 :   Test scripts/cw1/inputs/char-2.c
al3515 : ####################
basename $i .c
al3515 :   Test scripts/cw1/inputs/char-3.c
al3515 : ####################
basename $i .c
al3515 :   Test scripts/cw1/inputs/char-4.c
al3515 : ####################
basename $i .c
al3515 :   Test scripts/cw1/inputs/char-5.c
al3515 : ####################
basename $i .c
al3515 :   Test scripts/cw1/inputs/char-6.c
al3515 : ####################
basename $i .c
al3515 :   Test scripts/cw1/inputs/expr-1.c
al3515 : ####################
basename $i .c
al3515 :   Test scripts/cw1/inputs/expr-2.c
al3515 : ####################
basename $i .c
al3515 :   Test scripts/cw1/inputs/expr-3.c
al3515 : ####################
basename $i .c
al3515 :   Test scripts/cw1/inputs/expr-4.c
al3515 : ####################
basename $i .c
al3515 :   Test scripts/cw1/inputs/expr-5.c
al3515 : ####################
basename $i .c
al3515 :   Test scripts/cw1/inputs/expr-6.c
al3515 : ####################
basename $i .c
al3515 :   Test scripts/cw1/inputs/expr-7.c
al3515 : ####################
basename $i .c
al3515 :   Test scripts/cw1/inputs/expr-8.c
al3515 : ####################
basename $i .c
al3515 :   Test scripts/cw1/inputs/expr-9.c
al3515 : ####################
basename $i .c
al3515 :   Test scripts/cw1/inputs/float-1.c
al3515 : ####################
basename $i .c
al3515 :   Test scripts/cw1/inputs/float-2.c
al3515 : ####################
basename $i .c
al3515 :   Test scripts/cw1/inputs/float-3.c
al3515 : ####################
basename $i .c
al3515 :   Test scripts/cw1/inputs/float-4.c
al3515 : ####################
basename $i .c
al3515 :   Test scripts/cw1/inputs/float-5.c
al3515 : ####################
basename $i .c
al3515 :   Test scripts/cw1/inputs/float-6.c
al3515 : ####################
basename $i .c
al3515 :   Test scripts/cw1/inputs/float-8.c
al3515 : ####################
basename $i .c
al3515 :   Test scripts/cw1/inputs/float-9.c
al3515 : ####################
basename $i .c
al3515 :   Test scripts/cw1/inputs/include-0.c
al3515 : ####################
basename $i .c
al3515 :   Test scripts/cw1/inputs/include-1.c
al3515 : ####################
basename $i .c
al3515 :   Test scripts/cw1/inputs/include-2.c
al3515 : ####################
basename $i .c
al3515 :   Test scripts/cw1/inputs/include-3.c
al3515 : ####################
basename $i .c
al3515 :   Test scripts/cw1/inputs/int-1.c
al3515 : ####################
basename $i .c
al3515 :   Test scripts/cw1/inputs/int-2.c
al3515 : ####################
basename $i .c
al3515 :   Test scripts/cw1/inputs/int-3.c
al3515 : ####################
basename $i .c
al3515 :   Test scripts/cw1/inputs/int-4.c
al3515 : ####################
basename $i .c
al3515 :   Test scripts/cw1/inputs/int-5.c
al3515 : ####################
basename $i .c
al3515 :   Test scripts/cw1/inputs/int-6.c
al3515 : ####################
basename $i .c
al3515 :   Test scripts/cw1/inputs/int-7.c
al3515 : ####################
basename $i .c
al3515 :   Test scripts/cw1/inputs/pointer-1.c
al3515 : ####################
basename $i .c
al3515 :   Test scripts/cw1/inputs/pointer-2.c
al3515 : ####################
basename $i .c
al3515 :   Test scripts/cw1/inputs/pointer-3.c
al3515 : ####################
basename $i .c
al3515 :   Test scripts/cw1/inputs/pointer-4.c
al3515 : ####################
basename $i .c
al3515 :   Test scripts/cw1/inputs/stat-1.c
al3515 : ####################
basename $i .c
al3515 :   Test scripts/cw1/inputs/stat-2.c
al3515 : ####################
basename $i .c
al3515 :   Test scripts/cw1/inputs/stat-3.c
al3515 : ####################
basename $i .c
al3515 :   Test scripts/cw1/inputs/stat-4.c
al3515 : ####################
basename $i .c
al3515 :   Test scripts/cw1/inputs/stat-5.c
al3515 : ####################
basename $i .c
al3515 :   Test scripts/cw1/inputs/stat-6.c
al3515 : ####################
basename $i .c
al3515 :   Test scripts/cw1/inputs/string-1.c
al3515 : ####################
basename $i .c
al3515 :   Test scripts/cw1/inputs/string-2.c
al3515 : ####################
basename $i .c
al3515 :   Test scripts/cw1/inputs/string-3.c
al3515 : ####################
basename $i .c
al3515 :   Test scripts/cw1/inputs/string-4.c
al3515 : ####################
basename $i .c
al3515 :   Test scripts/cw1/inputs/string-5.c
al3515 : ####################
basename $i .c
al3515 :   Test scripts/cw1/inputs/string-6.c
al3515 : ####################
basename $i .c
al3515 :   Test scripts/cw1/inputs/string-7.c
al3515 : ####################
basename $i .c
al3515 :   Test scripts/cw1/inputs/string-8.c
al3515 : ####################
basename $i .c
al3515 :   Test scripts/cw1/inputs/struct-1.c
al3515 : ####################
basename $i .c
al3515 :   Test scripts/cw1/inputs/struct-2.c
al3515 : ####################
basename $i .c
al3515 :   Test scripts/cw1/inputs/struct-3.c
al3515 : ####################
basename $i .c
al3515 :   Test scripts/cw1/inputs/struct-4.c
al3515 : ####################
basename $i .c
al3515 :   Test scripts/cw1/inputs/var-decl-1.c
al3515 : ####################
basename $i .c
al3515 :   Test scripts/cw1/inputs/var-decl-2.c
al3515 : ####################
basename $i .c
al3515 :   Test scripts/cw1/inputs/var-decl-3.c
al3515 : ####################
basename $i .c
al3515 :   Test scripts/cw1/inputs/var-decl-4.c

cat $LOGDIR/working/*.compare.csv > $LOGDIR/working/all.compare.csv

python3 scripts/cw1/cw1-grade.py $U $LOGDIR/working/all.compare.csv $LOGDIR/$U-final.csv | tee $LOGDIR/summary.txt
    Token type | Percentage
          char |  66.67
          expr | 100.00
         float |  25.00
       include |   0.00
           int | 100.00
       pointer | 100.00
          stat | 100.00
        string |  56.25
        struct | 100.00
      var-decl | 100.00
                     |    Raw | Weight | Contrib
 Parts (token types) |  74.79 |  0.6 |  44.87
 StreamLine + Column |  70.00 |  0.2 |  14.00
 SourceFile+Line     |   0.00 |  0.2 |   0.00

Total :  58.87%

(cd $LOGDIR && tar -czf working.tar.gz working)

exit 0
al3515 : Test Complete
